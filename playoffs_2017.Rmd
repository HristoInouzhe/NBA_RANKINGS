---
  output:
  md_document:
  variant: markdown_github
---
  
# And the Winner of the 2017 NBA Playoffs is... The Golden State Warriors!
  
The 2017 NBA playoffs start ths weekend. So of course I had run the model through the [Elastic NBA Ratings](https://github.com/klarsen1/NBA_RANKINGS) to simulate the playoffs and pick a winner.

The result is not surprising: the Golden State Warriors won the title in every single simulation, barely losing any games along the way. What is surprising, howevever, is that the model picks the Boston Celtics as their opponent in the finals. This is after the Celtics have disposed the Cavs in five games, and Golden State have beaten San Antonio in four games! 

Obviously, this is just a model, and many things can happen. The style of play is different in the playoffs and injuries can strike at any time. But, barring any serious injuries, I feel confident that the Golden State will take the title this year. I feel less confident that Boston will indeed beat the Cavs in a playoff series, and I also strongly doubt that San Antonio beat Houston -- despite having the better record. 

# Should We Trust the Model?

First of all, we should never completely trust any statistical model. A statistical model is simply one of many inputs into our decision framework. But it's a valuable input because because they help us combine the many variables that often affect a given outcome into a single prediction. 

When I first did a [backtest](https://github.com/klarsen1/NBA_RANKINGS) of the Elastic Rankings, the accuracy was around 66%. For the first half of the 2016-2017 season, the one-week-ahead accuracy was 63%. This was computed by comparing the predictions stored every Sunday to the games during the following week -- from the beginning of December to the end of Ferbruary. Part of the decline in accuracy is due to the fact that the beginning of the season is harder to predict, part of of it is due to reasons that I have not dug into. 

Having said that, I decided that 63% is sufficient for me to go ahead and predict the playoffs while keeping a healthy dose of skepticism when it comes to the model's bullishness on the Celtics and Spurs.

# Why Does the Model Like the Warriors?

To answer this question, we can decompose the predictions into three parts:
 
* Roster -- archetype allocation deficits/surpluses. These are the variables labeled "share_minutes_cluster_XX" described above. This group of variables reflects the quality of the roster.
* Performance -- e.g., win percentages, previous match-ups.
* Circumstances -- e.g., travel, rest, home-court advantage
 
For more information on how this works, see the [readme file](https://github.com/klarsen1/NBA_RANKINGS). The code below decomposes season predictions generated on 2/12/17 (i.e., games played after 2/11/17):
 
```{r, echo=TRUE, message=FALSE, warning=FALSE}
library(tidyr)
library(dplyr)
library(knitr)
library(ggplot2)

r <-
  "https://raw.githubusercontent.com/klarsen1/NBA_RANKINGS/master/rankings/rankings_2017-04-14.csv"

qualifiers <- read.csv(r, stringsAsFactors=FALSE) %>%
    group_by(conference) %>% 
    mutate(rank=rank(-season_win_rate)) %>%
    filter(rank<9) %>%
    select(team) %>%
    rename(selected_team=team) %>%
    ungroup()
  

f <-
  "https://raw.githubusercontent.com/klarsen1/NBA_RANKINGS/master/modeldetails/score_decomp_2017-02-12.csv"
 
center <- function(x){return(x-median(x))}
read.csv(f, stringsAsFactors = FALSE) %>%
  select(selected_team, roster, circumstances, performance) %>%
  group_by(selected_team) %>%
  filter(selected_team %in% qual) %>%
  summarise_each(funs(mean)) %>% ## get averages across games by team
  ungroup() %>%
  mutate_each(funs(center), which(sapply(., is.numeric))) %>% ## standardize across teams
  gather(modelpart, value, roster:performance) %>% ## transpose
  rename(team=selected_team) %>%
  ggplot(aes(team, value)) + geom_bar(aes(fill=modelpart), stat="identity") + coord_flip() +
  xlab("") + ylab("") + theme(legend.title = element_blank())
 
```
 
The bars show the contribution from each part of the model. As expected, circumstances do not affect the overall prediction for the entire season as most teams have similarly taxing schedules. However, contributions from performance (weighted winning percentages) and roster (surplus of important player archetypes) vary considerably.

Some interesting observations:

* akdhas
* kadhkad







  